% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main_v2.R
\name{local_AIGENIE}
\alias{local_AIGENIE}
\title{Generate and Validate Psychometric Scale Items Using Local Models}
\usage{
local_AIGENIE(
  item.attributes,
  model.path,
  embedding.model = "bert-base-uncased",
  main.prompts = NULL,
  temperature = 1,
  top.p = 1,
  target.N = NULL,
  domain = NULL,
  scale.title = NULL,
  item.examples = NULL,
  audience = NULL,
  item.type.definitions = NULL,
  response.options = NULL,
  prompt.notes = NULL,
  system.role = NULL,
  EGA.model = NULL,
  EGA.algorithm = NULL,
  EGA.uni.method = NULL,
  n.ctx = 4096,
  n.gpu.layers = -1,
  max.tokens = 1024,
  device = "auto",
  batch.size = 32,
  pooling.strategy = "mean",
  max.length = 512L,
  keep.org = FALSE,
  items.only = FALSE,
  embeddings.only = FALSE,
  adaptive = TRUE,
  run.overall = FALSE,
  all.together = FALSE,
  plot = TRUE,
  silently = FALSE
)
}
\arguments{
\item{item.attributes}{Named list of item types and their attributes (required)}

\item{model.path}{Path to local GGUF model file (required)}

\item{embedding.model}{Name or path to local embedding model (default: "bert-base-uncased")}

\item{main.prompts}{Custom prompts for item generation (optional)}

\item{temperature}{LLM temperature for randomness (0-2, default: 1)}

\item{top.p}{Top-p nucleus sampling parameter (0-1, default: 1)}

\item{target.N}{Number of items to generate per type (default: 60)}

\item{domain}{Content domain (e.g., "psychological")}

\item{scale.title}{Name of the scale}

\item{item.examples}{Data frame of example items}

\item{audience}{Target population}

\item{item.type.definitions}{Definitions for item types}

\item{response.options}{Response scale labels}

\item{prompt.notes}{Additional instructions for generation}

\item{system.role}{Custom system prompt}

\item{EGA.model}{Network model ("glasso", "TMFG", or NULL for auto)}

\item{EGA.algorithm}{Community detection algorithm (default: "walktrap" when there is one trait and "louvain" when there are multiple)}

\item{EGA.uni.method}{Unidimensionality method (default: "louvain")}

\item{n.ctx}{Context window size (default: 4096)}

\item{n.gpu.layers}{GPU layers to use (-1 for all, default: -1)}

\item{max.tokens}{Maximum tokens per generation (default: 1024)}

\item{device}{Device for embeddings ("auto", "cpu", "cuda", "mps")}

\item{batch.size}{Batch size for embeddings (default: 32)}

\item{pooling.strategy}{Pooling for embeddings ("mean", "cls", "max")}

\item{max.length}{Max sequence length for embeddings (default: 512)}

\item{keep.org}{Keep original items and embeddings (default: FALSE)}

\item{items.only}{Generate items only, skip reduction (default: FALSE)}

\item{embeddings.only}{Generate embeddings only (default: FALSE)}

\item{adaptive}{Use adaptive generation (default: TRUE)}

\item{run.overall}{A logical value (optional, default: FALSE). Controls whether a \emph{fit} analysis
on the complete item pool is run \emph{post-reduction.}
By default, only type-level reduction analyses are run (i.e., items of like-type go through
the pipeline independent of the other items in the pool). When this flag is \code{TRUE}, an additional
analysis is run on the overall sample, but no further reductions at the overall level are made.
If only one item type is present, this argument will be ignored.}

\item{all.together}{A logical value (optional, default: FALSE). Controls whether the \emph{reduction} analysis
on the complete item pool is run.
By default, only type-level reduction analyses are run (i.e., items of like-type go through
the pipeline independent of the other items in the pool). When this flag is \code{TRUE}, reductions are made
at the overall level (i.e., all items go through the reduction pipeline together, agnostic of item type).
If only one item type is present, this argument will be ignored.}

\item{plot}{Display network plots (default: TRUE)}

\item{silently}{Suppress progress messages (default: FALSE)}
}
\value{
The structure of the return value depends on the function flags.

\strong{Defaults:} \code{items.only = FALSE}, \code{embeddings.only = FALSE},
\code{run.overall = FALSE}, \code{keep.org = FALSE}, \code{all.together = FALSE}.

\strong{When \code{items.only = TRUE}:}
Returns a \code{data.frame} of generated items with columns:
\code{ID}, \code{statement}, \code{type}, and \code{attribute}.

\strong{When \code{embeddings.only = TRUE}:}
Returns a named \code{list} with two elements:
\itemize{
\item \code{embeddings} — an embedding matrix/list (columns or rownames correspond to item IDs).
\item \code{items} — the items \code{data.frame} described above.
}

\strong{Default behaviour} (\code{items.only = FALSE}, \code{embeddings.only = FALSE},
\code{run.overall = FALSE}, \code{keep.org = FALSE}, \code{all.together = FALSE}):
Returns a named \code{list} with two top-level elements:
\describe{
\item{\code{item_type_level}}{A named list where each name is an item type and each element is a per-type named list containing:
\describe{
\item{\code{final_NMI}}{Numeric: final normalized mutual information after reduction.}
\item{\code{initial_NMI}}{Numeric: initial NMI of the pre-reduced item pool.}
\item{\code{embeddings}}{List or matrix of embeddings for this item type (see 'Notes on \code{embeddings}' below).}
\item{\code{UVA}}{List from Unique Variable Analysis (contains at least \code{n_removed}, \code{n_sweeps}, \code{redundant_pairs} data.frame).}
\item{\code{bootEGA}}{List with bootEGA results (e.g. \code{initial_boot}, \code{final_boot}, \code{n_removed}, \code{items_removed}, \code{initial_boot_with_redundancies}).}
\item{\code{EGA.model_selected}}{Character: chosen EGA model (e.g. \code{"TMFG"} or \code{"Glasso"}).}
\item{\code{final_items}}{\code{data.frame}: final items after reduction (columns include \code{ID}, \code{statement}, \code{attribute}, \code{type}, \code{EGA_com}).}
\item{\code{final_EGA}}{EGA object (from EGAnet) after reduction.}
\item{\code{initial_EGA}}{Initial EGA object computed on the pre-reduced item set.}
\item{\code{start_N}}{Integer: initial number of items in this type.}
\item{\code{final_N}}{Integer: final number of items in this type.}
\item{\code{network_plot}}{\code{ggplot} / \code{patchwork} object comparing networks before vs after reduction.}
\item{\code{stability_plot}}{\code{ggplot} / \code{patchwork} object showing item stability before vs after reduction.}
}
}

\item{\code{overall}}{Named list with aggregated results across all item types. Under the default this contains:
\describe{
\item{\code{final_items}}{\code{data.frame} of final items across all types (columns as above).}
\item{\code{embeddings}}{Embeddings for the full reduced item set (see 'Notes on \code{embeddings}' below). Note: \code{overall$embeddings} does \strong{not} include \code{selected}.}
}
}
}

\strong{When \code{keep.org = TRUE}} (in addition to defaults above):
The top-level shape remains (\code{item_type_level} and \code{overall}) but includes original (pre-reduction) information:
\describe{
\item{\code{item_type_level}}{Each per-type sublist contains:
\code{final_NMI}, \code{initial_NMI}, \code{embeddings}, \code{UVA}, \code{bootEGA}, \code{EGA.model_selected}, \code{final_items}, \code{initial_items}, \code{final_EGA}, \code{initial_EGA}, \code{start_N}, \code{final_N}, \code{network_plot}, \code{stability_plot}.}
\item{\code{overall}}{Contains \code{final_items}, \code{initial_items}, and \code{embeddings} for the full item pool.}
}
For \code{keep.org = TRUE}, per-type \code{embeddings} contains at least: \code{full_org}, \code{sparse_org}, \code{selected}, \code{full}, and \code{sparse}. (\code{overall$embeddings} contains the same subcomponents \strong{except} \code{selected} is omitted.)

\strong{When \code{run.overall = TRUE}} (\code{items.only = FALSE}, \code{embeddings.only = FALSE}):
\describe{
\item{\code{item_type_level}}{Same per-type structure as the default (see above).}
\item{\code{overall}}{A named list with aggregated results (not limited to \code{final_items} and \code{embeddings}) containing:
\code{final_NMI}, \code{initial_NMI}, \code{embeddings}, \code{EGA.model_selected}, \code{final_items}, \code{final_EGA}, \code{initial_EGA}, \code{start_N}, \code{final_N}, and \code{network_plot}.}
}

\strong{When \code{all.together = TRUE}} (regardless of \code{run.overall}):
Results are \strong{not} split into \code{item_type_level} and \code{overall}. Instead the function returns a single named list (applies to the full — possibly \code{keep.org} modified — result set) containing:
\code{final_NMI}, \code{initial_NMI}, \code{embeddings}, \code{UVA}, \code{bootEGA}, \code{EGA.model_selected}, \code{final_items}, \code{final_EGA}, \code{initial_EGA}, \code{start_N}, \code{final_N}, \code{network_plot}, and \code{stability_plot}.
}
\description{
Local version of AI-GENIE that uses locally installed language models and
embeddings for complete privacy and offline operation. Generates items,
creates embeddings, and performs network psychometric reduction entirely
on the user's machine.
}
\examples{
\dontrun{
########################################################
#### Running AIGENIE with a downloaded LLM model ######
########################################################

# Item type definitions
trait.definitions <- list(
 neuroticism = "Neuroticism is a personality trait that describes one's tendency to experience negative emotions like anxiety, depression, irritability, anger, and self-consciousness.",
 extraversion = "Extraversion is a personality trait that describes people who are more focused on the external world than their internal experience."
)

# Item attributes
aspects.of.personality.traits <- list(
 neuroticism = c("anxious", "depressed", "insecure", "emotional"),
 extraversion = c("friendly", "positive", "assertive", "energetic")
)

# Name the field or specialty
domain <- "Personality Measurement"

# Name the Inventory being created
scale.title <- "Two of 'Big Five:' A Streamlined Personality Inventory"

# Add a file path name to a local text generation model downloaded on your computer
model.path <- "ADD FILE PATH TO DOWNLOADED MODEL HERE"


# Generate and validate items using a model installed on your machine
local_example <- local_AIGENIE(
 item.attributes = aspects.of.personality.traits,
 item.type.definitions = trait.definitions,
 domain = domain,
 model.path = model.path
)

}
}
